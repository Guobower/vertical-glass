<?xml version="1.0"?>
<openerp>
    <data>
        <record model="ir.ui.view" id="sale_order_line_for_glass_form">
            <field name="name">sale_order_line_for_glass_form</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">
                <!-- SOL tree -->
                <xpath expr="//field[@name='order_line']/tree" position="replace">
                    <tree string="Sale lines" editable="">
                        <field name="currency_id" invisible="1"/>
                        <field name="name" />
                        <field name="description_structured" />
                        <field name="tax_id" />
                        <field name="price_unit" />
                    </tree>
                </xpath>
                <!-- SOL and SOLS forms -->
                <xpath expr="//field[@name='order_line']/form" position="replace">
                    <form string="Sales Order Lines">
                        <group>
                            <notebook>
                                <page string="Content">

                                    <field name="currency_id" invisible="1"/>

                                    <h3>
                                        <label string="Title" name="title"/>
                                    </h3>
                                    <field name="name" />
                                    <!-- SOL Sub Lines -->
                                    <field name="sale_order_line_sub_ids" mode="tree,kanban">
                                        <!-- SOL Sub Form -->
                                        <form string="Sale Order Sub line">
                                            <!-- Form title -->

                                            <field name="currency_id" invisible="1"/>

                                            <group col="4">
                                                <separator string="Sub Type" colspan="4" />
                                                <group colspan="2">
                                                    <field name="type" nolabel="1" />
                                                </group>
                                                <group colspan="2" />
                                            </group>

                                            <!-- Glass part -->
                                            <group name="main_glass" col="4" attrs="{'invisible':[('type', '!=', 'glass')]}">
                                                
                                                <hr colspan="4" />
                                                <separator string="Glass" colspan="4" />

                                                <group colspan="2">
                                                    <field name="category_id" domain="['|', ('name', '=ilike', 'vitrages'), ('parent_id', '=ilike', 'vitrages')]" attrs="{'required':[('type','=','glass')]}" />
                                                </group>
                                                <group colspan="1">
                                                    <field name="category_margin" readonly="1" attrs="{'invisible':[('category_id', '=', False)]}" />
                                                </group>
                                                <group colspan="1" />
                                                
                                                <group colspan="2">
                                                    <field name="glass_id" domain="[('categ_id', '=', category_id), ('sale_ok', '=', True)]" attrs="{'required':[('type','=','glass')]}" />
                                                </group>
                                                <group colspan="1">
                                                    <field name="price_unit_product" readonly="1" widget="monetary" attrs="{'invisible':[('glass_id', '=', False)]}" />
                                                </group>
                                                <group colspan="1" />
                                                
                                                <group colspan="2">
                                                    <field name="supplier_id" domain="[('glass_supplier', '=', True)]"/>
                                                </group>
                                                <group colspan="2" />

                                                <group colspan="1" col="1">
                                                    <field name="width" attrs="{'required':[('type','=','glass')]}" />
                                                </group>
                                                <group colspan="1" col="1">
                                                    <field name="height" attrs="{'required':[('type','=','glass')]}" />
                                                </group>
                                                <group colspan="1">
                                                    <field name="area" />
                                                </group>
                                                <group colspan="1">
                                                    <field name="price_base" readonly="1" nolabel="1" widget="monetary" attrs="{'invisible':[('glass_id', '=', False)]}" />
                                                </group>
                                                <!-- When Area is too big for the product -->
                                                <group col="2" colspan="4" attrs="{'invisible':[('area_max_exceeded', '=', False)]}">
                                                    <field name="area_max_exceeded" nolabel="1" invisible="1" />
                                                    <label colspan="2" string="The specified area for the product exceeds the maximum size on the product settings. If you leave the area as it, a message informing the customer about the loss of warranty will be added to the line. If you want to add the substitude product, use the button 'Substitute' in the form." color="red"/>
                                                    <field name="use_glass_substitude" on_change="change_glass_to_substitude()" />
                                                </group>

                                                <hr colspan="4" />
                                                <separator string="Constraints" colspan="4" />

                                                <hr colspan="4" />
                                                <separator string="Shape" colspan="4" />
                                                <group colspan="2">
                                                    <field name="shape_id" attrs="{'required':[('type','=','glass')]}" />
                                                </group>
                                                <group colspan="1">
                                                    <field name="shape_margin" readonly="1" attrs="{'invisible':[('shape_id', '=', False)]}" />
                                                </group>
                                                <group colspan="1">
                                                    <field name="price_shape" readonly="1" nolabel="1" widget="monetary" attrs="{'invisible':[('shape_id', '=', False)]}" />
                                                </group>

                                                <hr colspan="4" />
                                                <separator string="Surface Work" colspan="4"/>
                                                <group colspan="2">
                                                    <field name="finish_id"/>
                                                </group>
                                                <group colspan="1">
                                                    <field name="price_unit_finish" readonly="1" attrs="{'invisible':[('finish_id', '=', False)]}" />
                                                </group>
                                                <group colspan="1">
                                                    <field name="price_finish" readonly="1" nolabel="1" widget="monetary" attrs="{'invisible':[('finish_id', '=', False)]}" />
                                                </group>

                                                <hr colspan="4" />
                                                <separator string="Edge Work" colspan="4" />
                                                <group colspan="2">
                                                    <field name="edge_id" attrs="{'required':[('type','=','glass')]}" />
                                                </group>
                                                <group colspan="2">
                                                    <field name="price_unit_edge" readonly="1" nolabel="1" attrs="{'invisible':[('edge_id', '=', False)]}" />
                                                </group>

                                                <group colspan="1" col="1">
                                                    <field name="edge_width" widget="radio" options="{'horizontal': true}" />
                                                </group>
                                                <group colspan="1" col="1">
                                                    <field name="edge_height" widget="radio" options="{'horizontal': true}" />
                                                </group>
                                                <group colspan="1">
                                                    <field name="perimeter"/>
                                                </group>
                                                <group colspan="1">
                                                    <field name="price_edge" readonly="1" nolabel="1" widget="monetary" attrs="{'invisible':[('edge_id', '=', False)]}" />
                                                </group>
                                            </group>

                                            <!-- Accessory part -->
                                            <group name="main_accessory" col="4" attrs="{'invisible':[('type', '!=', 'accessory')]}" >

                                                <hr colspan="4" />
                                                <separator string="Accessory" colspan="4" />

                                                <group colspan="2">
                                                    <field name="accessory_id" domain="[('categ_id', 'not ilike', 'vitrages')]" attrs="{'required':[('type','=','accessory')]}" />
                                                </group>
                                                <group colspan="1" />
                                                <group colspan="1">
                                                    <field name="price_accessory" readonly="1" nolabel="1" widget="monetary" attrs="{'invisible':[('accessory_id', '=', False)]}" />
                                                </group>
                                            </group>

                                            <hr />
                                            <separator />

                                            <!-- Totals -->
                                            <group col="4">
                                                <group colspan="3">
                                                    <label string="Unit Sub-total" />
                                                </group>
                                                <group colspan="1">
                                                    <field name="subtotal_unit" readonly="1" nolabel="1" widget="monetary" />
                                                </group>

                                                <group colspan="2">
                                                    <label string="Quantity" />
                                                </group>
                                                <group colspan="1">
                                                    <field name="quantity" nolabel="1" />
                                                </group>
                                                <group colspan="1">
                                                    <field name="subtotal" readonly="1" nolabel="1" widget="monetary" />
                                                </group>

                                                <group colspan="2">
                                                    <label string="Margin (%)" />
                                                </group>
                                                <group colspan="1">
                                                    <field name="margin" nolabel="1" />
                                                </group>
                                                <group colspan="1">
                                                    <field name="total" readonly="1" nolabel="1" widget="monetary" />
                                                </group>
                                            </group>
                                            
                                        </form>
                                        <!-- SOL Sub Tree -->
                                        <tree>
                                            <field name="description" />
                                            <field name="quantity" />
                                            <field name="total" />
                                        </tree>
                                    </field>
                                    <group class="oe_subtotal_footer oe_right" colspan="2" name="total_lines">
                                        <field name="sub_lines_total" widget="monetary" />
                                    </group>
                                    <group col="1" colspan="3">
                                        <group col="5" colspan="5">
                                            <field name="men" />
                                            <field name="men_quantity" nolabel="1" />
                                            <label string="" />
                                            <label string="" />
                                        </group>
                                        <group col="5">
                                            <field name="installation" />
                                            <field name="installation_qty" nolabel="1" />
                                            <label string="x 1h x nbr hommes = " />
                                            <field name="installation_total" nolabel="1" widget="monetary" />
                                        </group>
                                        <group col="5">
                                            <field name="moving" />
                                            <field name="moving_qty" nolabel="1" />
                                            <label string="x 1h x nbr hommes = " />
                                            <field name="moving_total" nolabel="1" widget="monetary" />
                                        </group>
                                        <group col="5">
                                            <field name="km"/>
                                            <field name="km_qty" nolabel="1" />
                                            <label string="KM" />
                                            <field name="km_total" nolabel="1" />
                                        </group>
                                        <group col="3">
                                            <field name="miscellaneous_total" />
                                        </group>
                                        <group col="3">
                                            <field name="tax_id" string="Taxes" widget="many2many_tags" domain="[('type_tax_use','=','sale'),('company_id','=',parent.company_id)]" required="1"/>
                                        </group>
                                    </group>
                                    <separator />
                                    <group class="oe_subtotal_footer oe_right" colspan="4" name="total">
                                        <field name="price_tmp" />
                                        <field name="margin_applied" />
                                        <field name="price_unit" widget="monetary"/>
                                    </group>
                                </page>
                                <page string="Description">
                                    <field name="description_structured" readonly="1"/>
                                </page>
                            </notebook>
                        </group>
                    </form>
                </xpath>
            </field>
        </record>
    </data>
</openerp>
